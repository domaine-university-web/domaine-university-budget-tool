<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Money Breakdown Tool (Pro)</title>

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <style>
    :root{
      --pad: 16px;

      /* Domain Branded Theme (Gold / Black / White) */
      --bg: #0b0b0b;
      --card: #111111;
      --text: #ffffff;
      --muted: rgba(255,255,255,.72);
      --line: rgba(255,255,255,.14);
      --inputBg: #0f0f0f;
      --inputLine: rgba(255,255,255,.22);

      /* Domain-style gold */
      --gold: #d4af37;
      --gold2: #b9922f;

      --dangerBg: rgba(255, 82, 82, .16);
      --dangerText: #ffb3b3;

      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }

    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      margin: 0;
      padding: calc(env(safe-area-inset-top) + var(--pad)) var(--pad) calc(env(safe-area-inset-bottom) + 30px);
      background: radial-gradient(1200px 800px at 20% -10%, rgba(212,175,55,.18), transparent 55%),
                  radial-gradient(1200px 800px at 90% 10%, rgba(212,175,55,.10), transparent 60%),
                  var(--bg);
      color: var(--text);
      max-width: 820px;
    }

    h1 {
      font-size: 22px;
      margin: 0 0 12px;
      letter-spacing: .2px;
    }
    .subtitle{
      margin: 0 0 14px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .card {
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
    }

    label { display:block; margin: 6px 0 8px; font-weight: 700; color: rgba(255,255,255,.92); }

    input {
      width: 100%;
      padding: 14px 12px;
      font-size: 18px;
      border-radius: 12px;
      border: 1px solid var(--inputLine);
      background: var(--inputBg);
      color: var(--text);
      outline: none;
    }
    input:focus{
      border-color: rgba(212,175,55,.75);
      box-shadow: 0 0 0 4px rgba(212,175,55,.12);
    }

    .row { display:flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; align-items: center; }
    .row.tight{ margin-top: 10px; }
    .row > * { flex: 1; }

    button {
      padding: 14px 12px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid transparent;
      cursor: pointer;
      min-width: 160px;
      transition: transform .06s ease, opacity .2s ease;
    }
    button:active { transform: translateY(1px); }
    button.primary {
      background: linear-gradient(180deg, var(--gold), var(--gold2));
      color: #111;
      font-weight: 800;
      border-color: rgba(0,0,0,.35);
    }
    button.secondary {
      background: rgba(255,255,255,.08);
      color: var(--text);
      border-color: var(--line);
    }
    button.danger {
      background: var(--dangerBg);
      color: var(--dangerText);
      border-color: rgba(255, 130, 130, .22);
    }
    button:disabled{
      opacity: .5;
      cursor: not-allowed;
    }

    table { width:100%; border-collapse: collapse; margin-top: 12px; }
    th, td {
      padding: 12px 8px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      text-align:left;
      font-size: 15px;
      vertical-align: top;
    }
    th {
      font-size: 12px;
      color: rgba(255,255,255,.72);
      text-transform: uppercase;
      letter-spacing: .06em;
    }
    .total { font-weight: 800; }

    .split-header {
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      margin-top: 10px;
    }
    .split-header h2 { font-size: 16px; margin: 0; }
    .muted { color: var(--muted); font-size: 13px; line-height: 1.35; }

    .split-table input {
      padding: 12px 10px;
      font-size: 16px;
      border-radius: 10px;
    }
    .split-table td input { margin-top: 4px; }
    .pct-input { max-width: 140px; }
    .name-input { width: 100%; }

    .actions { display:flex; gap: 10px; align-items: center; justify-content: flex-end; flex-wrap: wrap; }
    .sum-badge{
      display:inline-flex;
      gap: 8px;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      font-size: 13px;
      color: rgba(255,255,255,.9);
      white-space: nowrap;
    }
    .sum-badge.good{
      border-color: rgba(212,175,55,.45);
      box-shadow: 0 0 0 4px rgba(212,175,55,.10);
    }
    .sum-badge.bad{
      border-color: rgba(255, 216, 120, .35);
      box-shadow: none;
    }
    .gold-dot{
      width: 8px; height: 8px; border-radius: 999px;
      background: var(--gold);
      box-shadow: 0 0 0 3px rgba(212,175,55,.16);
      display:inline-block;
    }

    .note {
      margin-top: 10px;
      color: rgba(255,255,255,.72);
      font-size: 13px;
      line-height: 1.35;
    }

    .tiny { font-size: 12px; color: rgba(255,255,255,.60); }

    /* âœ… PRO Watermark */
    .watermark{
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 9999;
      pointer-events: none;
      opacity: .14;
      font-weight: 900;
      letter-spacing: .22em;
      text-transform: uppercase;
      font-size: 34px;
      color: var(--gold);
      text-shadow: 0 10px 30px rgba(0,0,0,.55);
      transform: rotate(-10deg);
      user-select: none;
    }
    .watermark small{
      display:block;
      font-size: 10px;
      letter-spacing: .24em;
      color: rgba(212,175,55,.75);
      margin-top: 4px;
      text-align: right;
    }
  </style>
</head>

<body>
  <div class="watermark">PRO<small>DOMAIN</small></div>

  <h1>ðŸ’° Money Breakdown Tool (Pro)</h1>
  <p class="subtitle">
    Domain-branded money splitter. Edit categories + % and calculate the exact dollar amounts.
  </p>

  <div class="card">
    <label for="amount">Enter amount</label>
    <input id="amount" inputmode="decimal" placeholder="e.g., 2500" />

    <div class="split-header">
      <h2>Categories & Percentages</h2>
      <div class="actions">
        <span id="sumBadge" class="sum-badge"><span class="gold-dot"></span> Total: 0%</span>
      </div>
    </div>

    <!-- âœ… Auto-balance section removed -->

    <div class="row tight">
      <div class="muted" style="flex:1;">
        Tip: You can type <b>15</b> (meaning 15%) or <b>0.15</b> (also 15%).
      </div>
    </div>

    <table class="split-table" style="margin-top:10px;">
      <thead>
        <tr>
          <th style="width:55%;">Category</th>
          <th style="width:25%;">Percent</th>
          <th style="width:20%; text-align:right;">Action</th>
        </tr>
      </thead>
      <tbody id="splitTbody"></tbody>
    </table>

    <div class="row">
      <button class="secondary" onclick="addSplit()">+ Add category</button>
      <button class="secondary" onclick="resetSplits()">Reset defaults</button>
      <button class="primary" onclick="calculate()">Calculate</button>
      <button class="secondary" onclick="clearAll()">Clear</button>
    </div>

    <!-- âœ… OUTPUT: dollar amounts per category -->
    <div id="results" style="display:none;">
      <table>
        <thead>
          <tr><th>Category</th><th>%</th><th>Amount</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
        <tfoot>
          <tr class="total">
            <td>Total</td>
            <td id="totalPctCell">100%</td>
            <td id="totalCell"></td>
          </tr>
        </tfoot>
      </table>

      <div class="row">
        <button class="secondary" onclick="copyText()">Copy breakdown</button>
        <button class="primary" onclick="exportCSV()">Export to Spreadsheet (CSV)</button>
      </div>

      <div class="note" id="note">
        Rounds to cents. Any tiny rounding difference is adjusted into the <b>first</b> category.
      </div>
    </div>

    <div class="tiny" style="margin-top:10px;">
      Saved on this device: amount + categories + percentages.
    </div>
  </div>

<script>
  // âœ… Updated defaults to your requested categories
  const DEFAULT_SPLITS = [
    { name: "Living Expenses", pct: 50 },
    { name: "Tax", pct: 20 },
    { name: "Savings", pct: 10 },
    { name: "Investing", pct: 10 },
    { name: "Fun Money", pct: 10 },
  ];

  const LS_AMOUNT = "lastAmount";
  const LS_SPLITS = "moneyBreakdownSplitsV4"; // bumped version

  const amountEl = document.getElementById("amount");
  const splitTbody = document.getElementById("splitTbody");
  const sumBadge = document.getElementById("sumBadge");

  let splits = loadSplits();
  let pctInputs = []; // live references

  // Restore last amount
  const savedAmt = localStorage.getItem(LS_AMOUNT);
  if (savedAmt) amountEl.value = savedAmt;

  // Initial render
  renderSplits();
  updateSumBadge();

  // Recalc on amount changes if results are visible
  amountEl.addEventListener("input", () => {
    localStorage.setItem(LS_AMOUNT, amountEl.value.trim());
    if (document.getElementById("results").style.display !== "none") {
      if (Math.abs(totalPct() - 100) < 1e-9) calculate(true);
    }
  });

  // ---- Helpers ----
  function money(n) {
    return n.toLocaleString(undefined, { style: "currency", currency: "USD" });
  }

  function clamp(n, min, max) {
    return Math.min(max, Math.max(min, n));
  }

  // âœ… only treat 0 < n < 1 as a fraction
  function parsePct(value) {
    const s = String(value).trim().replace("%", "");
    if (s === "") return NaN;
    const n0 = Number(s);
    if (!isFinite(n0)) return NaN;
    let n = n0;
    if (n > 0 && n < 1) n = n * 100; // 0.15 => 15, but 1 => 1 (NOT 100)
    return n;
  }

  function roundPct(p) {
    const n = Number(p);
    if (!isFinite(n)) return "0";
    const isInt = Math.abs(n - Math.round(n)) < 1e-9;
    return isInt ? String(Math.round(n)) : String(Math.round(n * 100) / 100);
  }

  function totalPct() {
    return splits.reduce((sum, s) => sum + (Number(s.pct) || 0), 0);
  }

  function updateSumBadge() {
    const sum = Math.round(totalPct() * 100) / 100;
    sumBadge.textContent = `Total: ${roundPct(sum)}%`;
    sumBadge.classList.remove("bad","good");
    if (Math.abs(sum - 100) < 1e-9) sumBadge.classList.add("good");
    else sumBadge.classList.add("bad");
  }

  function saveSplits() {
    localStorage.setItem(LS_SPLITS, JSON.stringify(splits));
    updateSumBadge();
  }

  function loadSplits() {
    try {
      const raw = localStorage.getItem(LS_SPLITS);
      if (!raw) return structuredClone(DEFAULT_SPLITS);
      const parsed = JSON.parse(raw);
      if (!Array.isArray(parsed) || parsed.length === 0) return structuredClone(DEFAULT_SPLITS);
      return parsed.map(s => ({
        name: String(s.name ?? "").slice(0, 60),
        pct: clamp(Number(s.pct ?? 0), 0, 100)
      }));
    } catch {
      return structuredClone(DEFAULT_SPLITS);
    }
  }

  function escapeHtml(str) {
    return String(str ?? "").replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[c]));
  }

  // ---- UI Rendering ----
  function renderSplits() {
    splitTbody.innerHTML = "";
    pctInputs = [];

    splits.forEach((s, idx) => {
      const tr = document.createElement("tr");

      const nameTd = document.createElement("td");
      const nameInput = document.createElement("input");
      nameInput.className = "name-input";
      nameInput.placeholder = "Category name (e.g., Living Expenses)";
      nameInput.value = s.name;
      nameInput.addEventListener("input", () => {
        splits[idx].name = nameInput.value;
        saveSplits();
      });
      nameTd.appendChild(nameInput);

      const pctTd = document.createElement("td");
      const pctInput = document.createElement("input");
      pctInput.className = "pct-input";
      pctInput.inputMode = "decimal";
      pctInput.placeholder = "e.g., 15";
      pctInput.value = roundPct(s.pct);
      pctInputs[idx] = pctInput;

      // âœ… No auto-balance: user edits do NOT adjust other rows
      pctInput.addEventListener("input", () => {
        const entered = parsePct(pctInput.value);

        // allow typing-in-progress
        if (!isFinite(entered)) {
          updateSumBadge();
          return;
        }

        splits[idx].pct = clamp(entered, 0, 100);
        saveSplits();

        if (document.getElementById("results").style.display !== "none" &&
            Math.abs(totalPct() - 100) < 1e-9) {
          calculate(true);
        }
      });

      pctInput.addEventListener("blur", () => {
        pctInput.value = roundPct(splits[idx].pct);
      });

      pctTd.appendChild(pctInput);

      const actionTd = document.createElement("td");
      actionTd.style.textAlign = "right";
      const delBtn = document.createElement("button");
      delBtn.className = "danger";
      delBtn.type = "button";
      delBtn.textContent = "Remove";
      delBtn.style.padding = "10px 12px";
      delBtn.style.borderRadius = "10px";
      delBtn.style.minWidth = "0";
      delBtn.onclick = () => removeSplit(idx);
      delBtn.disabled = splits.length <= 1;
      actionTd.appendChild(delBtn);

      tr.appendChild(nameTd);
      tr.appendChild(pctTd);
      tr.appendChild(actionTd);
      splitTbody.appendChild(tr);
    });

    updateSumBadge();
  }

  function addSplit() {
    splits.push({ name: "", pct: 0 });
    saveSplits();
    renderSplits();
  }

  function removeSplit(idx) {
    if (splits.length <= 1) return;
    splits.splice(idx, 1);
    saveSplits();
    renderSplits();
  }

  function resetSplits() {
    splits = structuredClone(DEFAULT_SPLITS);
    saveSplits();
    renderSplits();
    document.getElementById("results").style.display = "none";
  }

  // ---- Calculation ----
  function calculate(silent = false) {
    const raw = amountEl.value.trim().replace(/[$, ]/g, "");
    const total = Number(raw);

    if (!isFinite(total) || total < 0) {
      if (!silent) alert("Enter a valid dollar amount (example: 2500).");
      return;
    }

    const cleaned = splits
      .map(s => ({ name: (s.name || "").trim(), pct: Number(s.pct) }))
      .filter(s => s.name && isFinite(s.pct) && s.pct >= 0);

    if (cleaned.length === 0) {
      if (!silent) alert("Add at least one category with a name.");
      return;
    }

    const pctSum = cleaned.reduce((a, b) => a + b.pct, 0);

    // Must be 100% for accurate output
    if (Math.abs(pctSum - 100) > 1e-9) {
      if (!silent) alert(`Your percentages must total 100%. Current total: ${roundPct(pctSum)}%.`);
      return;
    }

    // Save amount + splits
    localStorage.setItem(LS_AMOUNT, String(total));
    localStorage.setItem(LS_SPLITS, JSON.stringify(splits));

    const rows = cleaned.map(s => {
      const pctUsed = (s.pct / 100);
      return {
        name: s.name,
        pctDisplay: s.pct,
        pctUsed,
        value: Math.round(total * pctUsed * 100) / 100
      };
    });

    // Fix rounding drift by adjusting first row
    const sum = rows.reduce((a, b) => a + b.value, 0);
    const drift = Math.round((total - sum) * 100) / 100;
    rows[0].value = Math.round((rows[0].value + drift) * 100) / 100;

    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";
    rows.forEach(r => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${escapeHtml(r.name)}</td><td>${roundPct(r.pctDisplay)}%</td><td>${money(r.value)}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById("totalCell").textContent = money(total);
    document.getElementById("totalPctCell").textContent = "100%";
    document.getElementById("results").style.display = "block";

    const note = document.getElementById("note");
    note.innerHTML = `Rounds to cents. Any tiny rounding difference is adjusted into <b>${escapeHtml(rows[0].name)}</b>.`;

    window._lastBreakdown = {
      total,
      amounts: rows.map(r => ({ name: r.name, pct: r.pctDisplay/100, pctDisplay: r.pctDisplay, value: r.value }))
    };
  }

  function clearAll() {
    amountEl.value = "";
    localStorage.removeItem(LS_AMOUNT);
    document.getElementById("results").style.display = "none";
    document.getElementById("tbody").innerHTML = "";
    window._lastBreakdown = null;
  }

  async function copyText() {
    if (!window._lastBreakdown) return;
    const { total, amounts } = window._lastBreakdown;

    const lines = [
      `Money Breakdown Tool (Pro)`,
      `Total: ${money(total)}`,
      ...amounts.map(a => `${Math.round(a.pctDisplay*100)/100}% ${a.name}: ${money(a.value)}`)
    ].join("\n");

    try {
      await navigator.clipboard.writeText(lines);
      alert("Copied!");
    } catch {
      alert("Copy blocked. Here it is:\n\n" + lines);
    }
  }

  // ---- CSV Export ----
  function csvEscape(value) {
    const s = String(value ?? "");
    if (/[",\n\r]/.test(s)) return `"${s.replace(/"/g, '""')}"`;
    return s;
  }

  function downloadFile(filename, content, mime) {
    const blob = new Blob([content], { type: mime });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function exportCSV() {
    if (!window._lastBreakdown) {
      alert("Run Calculate first, then export.");
      return;
    }

    const { total, amounts } = window._lastBreakdown;

    const headers = ["Category", "Percent", "Amount"];
    const lines = [
      headers.map(csvEscape).join(","),
      ...amounts.map(a => [
        csvEscape(a.name),
        csvEscape(`${Math.round(a.pctDisplay * 100) / 100}%`),
        csvEscape(a.value.toFixed(2))
      ].join(",")),
      ["Total", "100%", total.toFixed(2)].map(csvEscape).join(",")
    ].join("\n");

    const stamp = new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");
    downloadFile(`money-breakdown-pro-${stamp}.csv`, lines, "text/csv;charset=utf-8");
  }
</script>
</body>
</html>
