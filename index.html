<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Money Breakdown Tool (Pro)</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- jsPDF for PDF Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --bg:#0b0b0b;
  --card:#111;
  --text:#fff;
  --muted:rgba(255,255,255,.65);
  --line:rgba(255,255,255,.12);
  --gold:#d4af37;
  --gold2:#b9922a;
  --danger:#ff5a5f;
  --radius:16px;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:20px;
  background:radial-gradient(900px 600px at 20% -10%, rgba(212,175,55,.15), transparent 50%),var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
  max-width:900px;
}

h1{
  margin:0 0 6px;
  font-size:22px;
}

.sub{
  font-size:13px;
  color:var(--muted);
  margin-bottom:14px;
}

.card{
  background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:14px;
  margin-bottom:16px;
}

label{
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:.06em;
  color:var(--muted);
  display:block;
  margin-bottom:6px;
}

input{
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:#000;
  color:#fff;
}

input:focus{
  outline:none;
  border-color:var(--gold);
}

.row{
  display:flex;
  gap:10px;
  margin-top:12px;
  flex-wrap:wrap;
}

button{
  padding:12px;
  border-radius:12px;
  border:1px solid transparent;
  cursor:pointer;
  font-size:15px;
}

.primary{
  background:linear-gradient(180deg,var(--gold),var(--gold2));
  color:#111;
  font-weight:800;
}

.secondary{
  background:rgba(255,255,255,.06);
  color:#fff;
  border-color:var(--line);
}

.danger{
  background:rgba(255,90,95,.12);
  color:#ffd2d3;
  border-color:rgba(255,90,95,.35);
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th,td{
  padding:10px;
  border-bottom:1px solid var(--line);
  text-align:left;
}

th{
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:.06em;
  color:var(--muted);
}

.total{
  font-weight:800;
  background:rgba(212,175,55,.08);
}

.status{
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  font-size:13px;
}

.status.bad{
  background:rgba(255,90,95,.12);
  border:1px solid rgba(255,90,95,.35);
  color:#ffd2d3;
}

.status.ok{
  background:rgba(212,175,55,.10);
  border:1px solid rgba(212,175,55,.35);
}

.watermark{
  position:fixed;
  bottom:12px;
  right:12px;
  opacity:.12;
  font-weight:900;
  letter-spacing:.25em;
  color:var(--gold);
  pointer-events:none;
}
</style>
</head>

<body>

<h1>ðŸ’° Money Breakdown Tool (Pro)</h1>
<div class="sub">Domaine Global â€¢ Pro Financial Allocation Tool</div>

<div class="card">
  <label for="amount">Total Amount</label>
  <!-- make amount a number input with step and min -->
  <input id="amount" type="number" step="0.01" min="0" placeholder="e.g. 5000">
</div>

<div class="card">
  <table id="categoryTable" aria-label="Categories">
    <thead>
      <tr>
        <th>Category</th>
        <th>%</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="row">
    <button type="button" class="secondary" onclick="addCategory()">+ Add Category</button>
  </div>

  <div id="percentStatus" class="status ok">Total Allocation: <b id="pctTotal">100%</b></div>
</div>

<div class="card">
  <div class="row">
    <button type="button" class="primary" onclick="calculate()">Calculate</button>
    <button type="button" class="secondary" onclick="exportPDF()">Export PDF</button>
    <button type="button" class="danger" onclick="resetAll()">Reset</button>
  </div>

  <table id="results" style="display:none" aria-live="polite">
    <thead>
      <tr>
        <th>Category</th>
        <th>%</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody id="resultsBody"></tbody>
    <tfoot>
      <tr class="total">
        <td>Total</td>
        <td>100%</td>
        <td id="totalAmount"></td>
      </tr>
    </tfoot>
  </table>
</div>

<div class="watermark">PRO</div>

<script>
/* Data */
let categories = [
  {name:"Living Expenses", pct:50},
  {name:"Taxes", pct:20},
  {name:"Savings", pct:10},
  {name:"Investing", pct:10},
  {name:"Fun Money", pct:10}
];

const tbody = document.querySelector("#categoryTable tbody");
const percentStatus = document.getElementById("percentStatus");
const EPS = 1e-6; // tolerance for float comparisons

/* Render categories using safe DOM methods (avoid innerHTML with user data) */
function renderCategories(){
  tbody.innerHTML = "";
  categories.forEach((c, i) => {
    const tr = document.createElement("tr");

    // Name cell
    const tdName = document.createElement("td");
    const nameInput = document.createElement("input");
    nameInput.type = "text";
    nameInput.value = c.name;
    nameInput.oninput = (e) => {
      categories[i].name = e.target.value;
    };
    tdName.appendChild(nameInput);

    // Percent cell
    const tdPct = document.createElement("td");
    const pctInput = document.createElement("input");
    pctInput.type = "number";
    pctInput.value = c.pct;
    pctInput.min = "0";
    pctInput.max = "100";
    pctInput.step = "0.01";
    pctInput.oninput = (e) => {
      const v = parseFloat(e.target.value);
      categories[i].pct = isFinite(v) ? v : 0;
      updatePct();
    };
    tdPct.appendChild(pctInput);

    // Remove cell
    const tdRemove = document.createElement("td");
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "danger";
    btn.textContent = "âœ•";
    btn.onclick = () => removeCategory(i);
    tdRemove.appendChild(btn);

    tr.appendChild(tdName);
    tr.appendChild(tdPct);
    tr.appendChild(tdRemove);
    tbody.appendChild(tr);
  });
  updatePct();
}

/* Update percentage display safely and consistently */
function updatePct(){
  const total = categories.reduce((a, c) => a + (Number(c.pct) || 0), 0);

  // Always render an element with id pctTotal so callers don't get null
  if (total > 100 + EPS) {
    percentStatus.className = "status bad";
    percentStatus.innerHTML = `âš  Total exceeds 100% â€” Total Allocation: <b id="pctTotal">${total}%</b>`;
  } else {
    percentStatus.className = "status ok";
    percentStatus.innerHTML = `Total Allocation: <b id="pctTotal">${total}%</b>`;
  }
}

/* Add / remove helpers */
function addCategory(){
  categories.push({name:"New Category", pct:0});
  renderCategories();
}

function removeCategory(i){
  categories.splice(i,1);
  renderCategories();
}

/* Calculate results (returns true on success) */
function calculate(){
  const totalAmount = parseFloat(document.getElementById("amount").value);
  if (!isFinite(totalAmount) || totalAmount <= 0) {
    alert("Enter a valid positive amount");
    return false;
  }

  const pctSum = categories.reduce((a, c) => a + (Number(c.pct) || 0), 0);
  if (Math.abs(pctSum - 100) > 0.0001) {
    alert("Percentages must equal 100%");
    return false;
  }

  const body = document.getElementById("resultsBody");
  body.innerHTML = ""; // clear previous
  categories.forEach(c => {
    const tr = document.createElement("tr");

    const tdName = document.createElement("td");
    tdName.textContent = c.name;

    const tdPct = document.createElement("td");
    tdPct.textContent = `${c.pct}%`;

    const tdAmt = document.createElement("td");
    const val = (totalAmount * (c.pct / 100));
    tdAmt.textContent = `$${val.toFixed(2)}`;

    tr.appendChild(tdName);
    tr.appendChild(tdPct);
    tr.appendChild(tdAmt);
    body.appendChild(tr);
  });

  document.getElementById("totalAmount").textContent = `$${totalAmount.toFixed(2)}`;
  document.getElementById("results").style.display = "table";
  return true;
}

/* Export to PDF â€” validate first */
function exportPDF(){
  // Validate and compute first
  if (!calculate()) return; // calculate will alert on failure

  const {jsPDF} = window.jspdf;
  const pdf = new jsPDF();
  pdf.setFontSize(14);
  pdf.text("Money Breakdown Tool (Pro)", 14, 16);
  let y = 30;
  const totalAmount = parseFloat(document.getElementById("amount").value);

  categories.forEach(c => {
    const amt = (totalAmount * (Number(c.pct) || 0) / 100).toFixed(2);
    pdf.setFontSize(11);
    pdf.text(`${c.name} â€” ${c.pct}% â€” $${amt}`, 14, y);
    y += 8;
    // simple page break guard
    if (y > 280) {
      pdf.addPage();
      y = 20;
    }
  });

  pdf.save("Money_Breakdown_Pro.pdf");
}

function resetAll(){
  location.reload();
}

/* Initial render */
renderCategories();
</script>

</body>
</html>
